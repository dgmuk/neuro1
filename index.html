import React, { useState, useEffect } from 'react';
import { BookOpen, Activity, AlertCircle, Info, ChevronRight, Menu, X, CheckCircle, Maximize, Minimize } from 'lucide-react';

// --- DATA STRUCTURE ---
const categories = [
  { id: 'general', title: 'Принципы безопасности' },
  { id: 'lower', title: 'Нижняя конечность' },
  { id: 'upper', title: 'Верхняя конечность' },
  { id: 'self', title: 'Самостоятельные тесты' },
];

const testsData = {
  general: [
    {
      id: 'safety',
      title: 'Общие принципы',
      nerve: 'Безопасность пациента',
      description: 'Главное правило: Терапевт должен быть «самым безопасным человеком в комнате» (Дэвид Батлер).',
      steps: [
        'Не хватайте конечность жестко или агрессивно.',
        'Используйте мягкий захват, подкладывайте руку под конечность.',
        'Занимайте удобную позицию (используйте вес корпуса, а не силу рук).',
        'Инструктаж: "Я сейчас буду двигать вашу ногу. Скажите, если почувствуете натяжение или дискомфорт".'
      ],
      nuances: [
        'Результат зависит от того, КАК вы делаете тест, а не только КАКОЙ тест.',
        'Положительный тест: воспроизведение знакомой боли, асимметрия (L!=R), значительное ограничение амплитуды (<40°).',
        'У гимнастов амплитуда может быть 90°+, но тест все равно может быть положительным при наличии симптомов.'
      ],
      illustration: 'general'
    }
  ],
  lower: [
    {
      id: 'slr',
      title: 'Подъем прямой ноги (SLR)',
      nerve: 'Седалищный нерв / Поясничные корешки',
      description: 'Базовый тест натяжения. Lasegue test.',
      steps: [
        'И.П.: Пациент лежит на спине.',
        'Терапевт одной рукой удерживает пятку.',
        'Вторая рука лежит СВЕРХУ на колене (не давить, просто контроль).',
        'Медленно поднимаем прямую ногу вверх.',
        'Сравниваем левую и правую стороны.'
      ],
      nuances: [
        'Норма: около 40° и выше.',
        'Важна разница сторон (D=S).',
        'Если у пациента большая нога (как у регбиста), используйте свой корпус, а не только руки.'
      ],
      illustration: 'slr_sciatic'
    },
    {
      id: 'peroneal',
      title: 'Малоберцовый нерв',
      nerve: 'N. Peroneus (Латеральная поверхность голени, спереди лодыжки)',
      description: 'Модификация SLR для малоберцового нерва.',
      steps: [
        'И.П.: Как при SLR.',
        'Выполнить ИНВЕРСИЮ стопы (стопа внутрь).',
        'Выполнить ПЛАНТАРФЛЕКСИЮ (носок от себя).',
        'В этом зафиксированном положении поднимаем прямую ногу.'
      ],
      nuances: [
        'Нерв проходит спереди от латеральной лодыжки.',
        'Натягиваем передне-латеральную поверхность.',
        'Можно проверить знаком Тинеля (постукивание у головки малоберцовой кости).'
      ],
      illustration: 'slr_peroneal'
    },
    {
      id: 'tibial',
      title: 'Большеберцовый нерв',
      nerve: 'N. Tibialis (Медиальная поверхность голени, позади лодыжки)',
      description: 'Тарзальный канал, жгучие боли в стопе.',
      steps: [
        'И.П.: Как при SLR.',
        'Выполнить ЭВЕРСИЮ стопы (стопа наружу).',
        'Выполнить ДОРСИФЛЕКСИЮ (носок на себя).',
        'Поднять прямую ногу, удерживая стопу.'
      ],
      nuances: [
        'Нерв проходит позади медиальной лодыжки.',
        'Часто связано с тесной обувью.',
        'Стойте ближе к пациенту, прижмите локти к корпусу для контроля.'
      ],
      illustration: 'slr_tibial'
    },
    {
      id: 'sural',
      title: 'Икроножный нерв',
      nerve: 'N. Suralis (Латеральная поверхность, сзади лодыжки)',
      description: 'Часто путают с ахиллотендинитом.',
      steps: [
        'И.П.: Как при SLR.',
        'Выполнить ИНВЕРСИЮ стопы (стопа внутрь).',
        'Выполнить ДОРСИФЛЕКСИЮ (носок на себя).',
        'Поднять прямую ногу.'
      ],
      nuances: [
        'Захват: проще всего предплечьем или корпусом создавать дорсифлексию, а рукой уводить в инверсию.',
        'Симптомы часто возникают после бега или нагрузки.'
      ],
      illustration: 'slr_sural'
    },
    {
      id: 'femoral',
      title: 'Бедренный нерв',
      nerve: 'N. Femoralis (Передняя поверхность бедра)',
      description: 'Самый сложный технически тест.',
      steps: [
        'И.П.: Пациент лежит на ЖИВОТЕ.',
        'Одной рукой мягко фиксируем крестец (чтобы таз не поднимался).',
        'Второй рукой сгибаем колено и разгибаем бедро (поднимаем ногу вверх).',
      ],
      nuances: [
        'Не давить агрессивно на крестец, просто контроль.',
        'Тест натягивает и квадрицепс тоже.',
        'Следите, чтобы пациент мог расслабиться.'
      ],
      illustration: 'femoral'
    }
  ],
  upper: [
    {
      id: 'ulnt1',
      title: 'ULNT 1 (Срединный нерв)',
      nerve: 'N. Medianus',
      description: 'Базовый тест. Позиция "Пистолет".',
      steps: [
        'И.П.: Пациент на краю стола. Терапевт сбоку в разножке.',
        'Фиксация надплечья (чтобы не поднималось).',
        'Плечо отведено на 90°, локоть согнут 90°.',
        'Хват "Пистолет": захват пальцев, указательный и большой фиксируют большой палец пациента.',
        'Движение: Наружная ротация плеча -> Супинация -> Разгибание кисти -> Разгибание локтя.'
      ],
      nuances: [
        'Важно разогнуть большой палец пациента.',
        'Разгибание локтя выполняется в конце для точного определения момента боли.'
      ],
      illustration: 'ulnt1'
    },
    {
      id: 'ulnt2a',
      title: 'ULNT 2A (Срединный нерв)',
      nerve: 'N. Medianus (Альтернатива)',
      description: 'Терапевт у головы. Хват "Лебедь".',
      steps: [
        'И.П.: Пациент лежит по диагонали, плечо свисает.',
        'Терапевт стоит у головы. Внутренняя рука под локтем.',
        'Локоть пациента лежит на локтевом сгибе терапевта.',
        'Кисть в супинации, пальцы разогнуты.',
        'Движение: Отведение плеча + разгибание локтя.'
      ],
      nuances: [
        'Удобно для расслабления руки пациента (рука лежит на предплечье терапевта).',
        'Минус: терапевт не видит лица пациента, нужно спрашивать об ощущениях.'
      ],
      illustration: 'ulnt2a'
    },
    {
      id: 'ulnt2b',
      title: 'ULNT 2B (Лучевой нерв)',
      nerve: 'N. Radialis',
      description: 'Позиция "Официант проливает поднос" (внутренняя ротация).',
      steps: [
        'И.П.: Как в 2A (терапевт у головы).',
        'Используем ВНЕШНЮЮ руку под локоть.',
        'Движение: ПРОНАЦИЯ предплечья (внутрь).',
        'Сгибание кисти в кулак (пальцы внутрь).',
        'Сгибание кисти.',
        'Отведение плеча в сторону.'
      ],
      nuances: [
        'Локоть пациента должен быть зафиксирован.',
        'Натяжение по задней поверхности руки.'
      ],
      illustration: 'ulnt2b'
    },
    {
      id: 'ulnt3',
      title: 'ULNT 3 (Локтевой нерв)',
      nerve: 'N. Ulnaris',
      description: 'Позиция "Маска" или "Очки".',
      steps: [
        'И.П.: Как в ULNT 1.',
        'Разгибание пальцев и кисти.',
        'ПРОНАЦИЯ предплечья.',
        'Сгибание локтя (подносим ладонь к уху пациента ("послушать ухо")).',
        'Следить, чтобы плечо не поднималось к уху.'
      ],
      nuances: [
        'Акцент на мизинец и безымянный палец.',
        'Похоже на то, как будто человек делает очки из пальцев вокруг глаза.'
      ],
      illustration: 'ulnt3'
    }
  ],
  self: [
    {
      id: 'self_median',
      title: 'Срединный нерв (Самостоятельно)',
      nerve: 'N. Medianus',
      description: 'Упражнение для пациента.',
      steps: [
        'Встать прямо.',
        'Отвести руку в сторону, ладонью ВВЕРХ.',
        'Разогнуть кисть (потянуть пальцы вниз к полу).',
        'Наклонить голову в ПРОТИВОПОЛОЖНУЮ сторону.'
      ],
      nuances: [
        'Ощущение натяжения должно быть комфортным, не острым.',
        'Сравнить с другой стороной.'
      ],
      illustration: 'self_median'
    },
    {
      id: 'self_radial',
      title: 'Лучевой нерв (Самостоятельно)',
      nerve: 'N. Radialis',
      description: 'Упражнение для пациента.',
      steps: [
        'Рука опущена вниз и чуть в сторону.',
        'Завернуть руку внутрь (пронация).',
        'Сжать легкий кулак.',
        'Согнуть кулак (костяшки тянутся к предплечью).',
        'Наклонить голову в ПРОТИВОПОЛОЖНУЮ сторону.'
      ],
      nuances: [
        'Тянет по тыльной стороне предплечья.'
      ],
      illustration: 'self_radial'
    },
    {
      id: 'self_ulnar',
      title: 'Локтевой нерв (Самостоятельно)',
      nerve: 'N. Ulnaris',
      description: 'Позиция "Очки" или "Маска".',
      steps: [
        'Сделать знак "ОК" (соединить большой и указательный).',
        'Перевернуть кисть пальцами к лицу.',
        'Поднести кисть к глазу (как будто смотрите в бинокль или очки).',
        'Локоть поднять в сторону/вверх.',
        'Наклонить голову в ПРОТИВОПОЛОЖНУЮ сторону.'
      ],
      nuances: [
        'Очень эффективное упражнение для снятия напряжения.'
      ],
      illustration: 'self_ulnar'
    }
  ]
};

// --- SVG ILLUSTRATIONS ---
const Illustration = ({ type }) => {
  const baseStyle = { strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" };
  const nerveStyle = { stroke: "#ef4444", strokeWidth: "3", strokeDasharray: "4 2", opacity: "0.8" }; // Red dashed line for nerve

  switch (type) {
    case 'general':
      return (
        <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
           <text x="100" y="30" textAnchor="middle" fill="#64748b" fontSize="12">Безопасность</text>
           {/* Bed */}
           <rect x="20" y="100" width="160" height="10" fill="#cbd5e1" />
           <rect x="20" y="110" width="10" height="30" fill="#cbd5e1" />
           <rect x="170" y="110" width="10" height="30" fill="#cbd5e1" />
           {/* Patient */}
           <path d="M40,100 L160,100" stroke="#334155" strokeWidth="4" />
           <circle cx="150" cy="90" r="8" fill="#cbd5e1" />
           {/* Therapist Hands - Safe Grip */}
           <path d="M100,100 Q100,80 120,70" stroke="#10b981" strokeWidth="3" fill="none" />
           <circle cx="100" cy="100" r="15" stroke="#10b981" strokeWidth="2" strokeDasharray="4 4" fill="none" />
           <text x="100" y="130" textAnchor="middle" fill="#10b981" fontSize="10">Мягкий контроль</text>
        </svg>
      );
    // LOWER LIMB
    case 'slr_sciatic':
      return (
        <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
          <text x="10" y="20" className="text-xs" fill="#94a3b8">Sciatic Nerve (SLR)</text>
          {/* Body */}
          <line x1="20" y1="120" x2="100" y2="120" stroke="#334155" {...baseStyle} />
          <circle cx="20" cy="115" r="8" stroke="#334155" fill="none" />
          {/* Leg Raised */}
          <line x1="100" y1="120" x2="160" y2="60" stroke="#334155" strokeWidth="4" />
          {/* Nerve Path */}
          <path d="M100,122 L158,62" {...nerveStyle} />
          {/* Foot Neutral */}
          <path d="M160,60 L155,50" stroke="#334155" strokeWidth="3" />
          {/* Therapist Hand */}
          <circle cx="160" cy="60" r="5" fill="#10b981" opacity="0.5" />
          <text x="170" y="50" fontSize="10" fill="#334155">40°+</text>
        </svg>
      );
    case 'slr_peroneal':
      return (
        <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
          <text x="10" y="20" className="text-xs" fill="#94a3b8">Peroneal (SLR + Inv + PF)</text>
           {/* Leg Raised */}
           <line x1="80" y1="120" x2="140" y2="60" stroke="#334155" strokeWidth="4" />
           {/* Nerve Path (Lateral/Front) */}
           <path d="M80,118 L142,58" {...nerveStyle} stroke="#ef4444" />
           {/* Foot: Plantar Flexion (Pointed) + Inversion */}
           <path d="M140,60 L155,70" stroke="#334155" strokeWidth="3" />
           <path d="M150,70 L145,80" stroke="#334155" strokeWidth="3" />
           {/* Indicators */}
           <text x="160" y="80" fontSize="10" fill="#334155">PF + Inv</text>
        </svg>
      );
      case 'slr_tibial':
        return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Tibial (SLR + Ev + DF)</text>
             {/* Leg Raised */}
             <line x1="80" y1="120" x2="140" y2="60" stroke="#334155" strokeWidth="4" />
             {/* Nerve Path (Back/Medial) */}
             <path d="M82,122 L138,62" {...nerveStyle} />
             {/* Foot: Dorsiflexion (Up) + Eversion */}
             <path d="M140,60 L135,45" stroke="#334155" strokeWidth="3" />
             <path d="M135,45 L145,40" stroke="#334155" strokeWidth="3" />
             <text x="150" y="40" fontSize="10" fill="#334155">DF + Ev</text>
          </svg>
        );
      case 'slr_sural':
        return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Sural (SLR + Inv + DF)</text>
             {/* Leg Raised */}
             <line x1="80" y1="120" x2="140" y2="60" stroke="#334155" strokeWidth="4" />
             {/* Nerve Path (Lateral/Back) */}
             <path d="M80,122 L142,62" {...nerveStyle} />
             {/* Foot: Dorsiflexion (Up) + Inversion */}
             <path d="M140,60 L135,45" stroke="#334155" strokeWidth="3" />
             <path d="M135,45 L125,50" stroke="#334155" strokeWidth="3" />
             <text x="100" y="50" fontSize="10" fill="#334155">DF + Inv</text>
          </svg>
        );
      case 'femoral':
        return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Femoral (Prone)</text>
             {/* Body Prone */}
             <ellipse cx="60" cy="100" rx="30" ry="10" stroke="#334155" fill="none" />
             <circle cx="25" cy="100" r="8" stroke="#334155" fill="none" />
             {/* Leg Bent */}
             <path d="M90,100 L130,100 L130,60" stroke="#334155" strokeWidth="4" fill="none" />
             {/* Nerve Path (Anterior) */}
             <path d="M90,98 L128,98 L128,65" {...nerveStyle} />
             {/* Hand Stabilizing Sacrum */}
             <path d="M80,95 L90,95" stroke="#10b981" strokeWidth="3" />
             <text x="140" y="80" fontSize="10" fill="#334155">Колено согнуто</text>
          </svg>
        );

      // UPPER LIMB
      case 'ulnt1':
        return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Median (ULNT 1)</text>
             {/* Torso */}
             <rect x="80" y="50" width="40" height="80" stroke="#334155" fill="none" />
             <circle cx="100" cy="35" r="10" stroke="#334155" fill="none" />
             {/* Arm Abducted 90, Elbow extended/extending */}
             <path d="M120,60 L160,60 L190,60" stroke="#334155" strokeWidth="4" />
             {/* Hand Extended */}
             <path d="M190,60 L195,50" stroke="#334155" strokeWidth="3" />
             {/* Nerve */}
             <path d="M120,62 L190,62" {...nerveStyle} />
             <text x="150" y="80" fontSize="10" fill="#334155">Ладонь открыта</text>
          </svg>
        );
      case 'ulnt2a':
        return (
           <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Median (ULNT 2A)</text>
              {/* Torso Diagonal */}
             <rect x="60" y="60" width="40" height="70" transform="rotate(-15 80 95)" stroke="#334155" fill="none" />
             {/* Arm depressed */}
             <line x1="90" y1="60" x2="140" y2="80" stroke="#334155" strokeWidth="4" />
             <line x1="140" y1="80" x2="180" y2="100" stroke="#334155" strokeWidth="4" />
             {/* Nerve */}
             <path d="M90,62 L180,102" {...nerveStyle} />
             <text x="130" y="50" fontSize="10" fill="#334155">Плечо опущено</text>
           </svg>
        );
      case 'ulnt2b':
        return (
           <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Radial (ULNT 2B)</text>
             {/* Arm */}
             <path d="M90,60 L140,80 L180,100" stroke="#334155" strokeWidth="4" fill="none"/>
             {/* Hand Flexed (Fist) */}
             <circle cx="185" cy="105" r="5" fill="#334155" />
             {/* Nerve - Radial (spiral groove hint hard to draw, just showing path) */}
             <path d="M90,58 L140,78 L180,98" {...nerveStyle} strokeDasharray="2 2" />
             <text x="130" y="120" fontSize="10" fill="#334155">Пронация + Кулак</text>
           </svg>
        );
      case 'ulnt3':
        return (
           <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Ulnar (ULNT 3)</text>
             {/* Torso */}
             <rect x="80" y="60" width="40" height="70" stroke="#334155" fill="none" />
             <circle cx="100" cy="45" r="10" stroke="#334155" fill="none" />
             {/* Arm: Abducted, Elbow Flexed fully */}
             <path d="M120,70 L160,70 L130,50" stroke="#334155" strokeWidth="4" fill="none"/>
             {/* Hand at ear */}
             <circle cx="125" cy="45" r="5" fill="#334155" opacity="0.5"/>
             {/* Nerve */}
             <path d="M120,72 L160,72 L130,52" {...nerveStyle} />
             <text x="160" y="60" fontSize="10" fill="#334155">"Очки"</text>
           </svg>
        );

      // SELF
      case 'self_median':
        return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Self Median</text>
             {/* Standing Figure */}
             <line x1="100" y1="40" x2="100" y2="100" stroke="#334155" strokeWidth="4" />
             <circle cx="100" cy="30" r="10" stroke="#334155" fill="none" />
             {/* Arm out, palm up, wrist extended down */}
             <line x1="100" y1="50" x2="160" y2="50" stroke="#334155" strokeWidth="4" />
             <line x1="160" y1="50" x2="160" y2="65" stroke="#334155" strokeWidth="4" />
             {/* Head tilt away */}
             <path d="M95,20 L85,25" stroke="#334155" strokeWidth="2" />
             {/* Nerve */}
             <path d="M100,52 L160,52 L160,65" {...nerveStyle} />
          </svg>
        );
      case 'self_radial':
         return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Self Radial</text>
             {/* Standing Figure */}
             <line x1="100" y1="40" x2="100" y2="100" stroke="#334155" strokeWidth="4" />
             <circle cx="100" cy="30" r="10" stroke="#334155" fill="none" />
             {/* Arm down, internally rotated, wrist flexed */}
             <line x1="100" y1="50" x2="140" y2="90" stroke="#334155" strokeWidth="4" />
             <circle cx="138" cy="95" r="4" fill="#334155" />
             {/* Head tilt away */}
             <path d="M95,20 L85,25" stroke="#334155" strokeWidth="2" />
             <path d="M100,52 L140,92" {...nerveStyle} />
          </svg>
        );
       case 'self_ulnar':
         return (
          <svg viewBox="0 0 200 150" className="w-full h-full bg-slate-50 rounded-lg">
             <text x="10" y="20" className="text-xs" fill="#94a3b8">Self Ulnar</text>
             {/* Standing Figure */}
             <line x1="100" y1="40" x2="100" y2="100" stroke="#334155" strokeWidth="4" />
             {/* Arm up, elbow bent, hand to eye */}
             <path d="M100,50 L140,50 L115,30" stroke="#334155" strokeWidth="4" fill="none"/>
             <circle cx="115" cy="30" r="5" fill="#334155" opacity="0.5"/>
             <circle cx="100" cy="30" r="10" stroke="#334155" fill="none" />
              {/* Head tilt away */}
             <path d="M95,20 L85,25" stroke="#334155" strokeWidth="2" />
             <path d="M100,52 L140,52 L115,32" {...nerveStyle} />
          </svg>
        );

    default:
      return <div className="w-full h-full bg-gray-100 flex items-center justify-center text-gray-400">Нет изображения</div>;
  }
};

const App = () => {
  const [activeCategory, setActiveCategory] = useState('lower');
  const [activeTest, setActiveTest] = useState(testsData.lower[0]);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [toastMessage, setToastMessage] = useState(null);

  useEffect(() => {
    const handleFullscreenChange = () => {
      setIsFullscreen(!!document.fullscreenElement);
    };
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);
  }, []);

  const handleCategoryChange = (catId) => {
    setActiveCategory(catId);
    setActiveTest(testsData[catId][0]);
    setIsMobileMenuOpen(false);
  };

  const handleTestChange = (test) => {
    setActiveTest(test);
    setIsMobileMenuOpen(false);
  };

  const showToast = (msg) => {
    setToastMessage(msg);
    setTimeout(() => setToastMessage(null), 3000);
  };

  const toggleFullScreen = () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(err => {
        console.warn(`Error attempting to enable full-screen mode: ${err.message}`);
        showToast("Полноэкранный режим недоступен в окне предпросмотра");
      });
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
    }
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex flex-col md:flex-row relative">
      
      {/* TOAST NOTIFICATION */}
      {toastMessage && (
        <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-lg shadow-lg text-sm z-50 transition-opacity duration-300 opacity-100 flex items-center gap-2">
            <AlertCircle size={16} className="text-amber-400"/>
            {toastMessage}
        </div>
      )}

      {/* MOBILE HEADER */}
      <div className="md:hidden bg-white p-4 shadow-sm flex justify-between items-center sticky top-0 z-20">
        <h1 className="font-bold text-lg text-slate-700 flex items-center gap-2">
          <Activity className="text-teal-600" size={24} /> Нейродинамика
        </h1>
        <div className="flex gap-2">
           <button onClick={toggleFullScreen} className="p-2 text-slate-600">
            {isFullscreen ? <Minimize size={24} /> : <Maximize size={24} />}
          </button>
          <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="p-2 text-slate-600">
            {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
          </button>
        </div>
      </div>

      {/* SIDEBAR NAVIGATION (Desktop) */}
      <aside className={`fixed inset-0 z-10 bg-white md:relative md:w-80 border-r border-slate-200 transform ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 transition-transform duration-200 ease-in-out overflow-y-auto`}>
        <div className="p-6 hidden md:block">
          <h1 className="font-bold text-xl text-slate-700 flex items-center gap-2">
            <Activity className="text-teal-600" size={28} /> Нейродинамика
          </h1>
          <p className="text-sm text-slate-400 mt-1">Практическое руководство</p>
        </div>

        <nav className="p-4 space-y-8">
          {categories.map((cat) => (
            <div key={cat.id}>
              <h3 
                className={`text-xs font-semibold uppercase tracking-wider mb-3 px-3 cursor-pointer ${activeCategory === cat.id ? 'text-teal-600' : 'text-slate-400'}`}
                onClick={() => handleCategoryChange(cat.id)}
              >
                {cat.title}
              </h3>
              <ul className="space-y-1">
                {testsData[cat.id].map((test) => (
                  <li key={test.id}>
                    <button
                      onClick={() => handleTestChange(test)}
                      className={`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center justify-between group ${activeTest.id === test.id ? 'bg-teal-50 text-teal-700 font-medium' : 'text-slate-600 hover:bg-slate-100'}`}
                    >
                      {test.title}
                      {activeTest.id === test.id && <ChevronRight size={16} />}
                    </button>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      {/* MAIN CONTENT AREA */}
      <main className="flex-1 p-4 md:p-8 overflow-y-auto relative">
        
        {/* Desktop Fullscreen Button */}
        <button 
          onClick={toggleFullScreen} 
          className="hidden md:flex absolute top-4 right-4 p-2 bg-white rounded-full shadow-sm border border-slate-200 text-slate-500 hover:text-teal-600 hover:border-teal-200 transition-all z-10"
          title={isFullscreen ? "Выйти из полноэкранного режима" : "На весь экран"}
        >
          {isFullscreen ? <Minimize size={20} /> : <Maximize size={20} />}
        </button>

        <div className="max-w-4xl mx-auto">
          
          {/* HEADER CARD */}
          <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 mb-6">
            <div className="flex items-start justify-between flex-col md:flex-row gap-4">
              <div>
                <span className="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-teal-100 text-teal-800 mb-3">
                  {categories.find(c => c.id === activeCategory)?.title}
                </span>
                <h2 className="text-2xl md:text-3xl font-bold text-slate-800 mb-2">{activeTest.title}</h2>
                <div className="flex items-center gap-2 text-slate-500 text-sm">
                  <Activity size={16} />
                  <span>Целевой нерв: <strong className="text-slate-700">{activeTest.nerve}</strong></span>
                </div>
              </div>
              
              {/* ILLUSTRATION CARD (Mobile: Full width, Desktop: Side card) */}
              <div className="w-full md:w-64 h-48 flex-shrink-0 bg-slate-50 rounded-xl border border-slate-100 overflow-hidden relative shadow-inner">
                <Illustration type={activeTest.illustration} />
                <div className="absolute bottom-2 right-2 text-[10px] text-slate-400 bg-white/80 px-2 py-1 rounded">Схема</div>
              </div>
            </div>
            
            <p className="mt-4 text-slate-600 leading-relaxed border-t border-slate-100 pt-4">
              {activeTest.description}
            </p>
          </div>

          {/* CONTENT GRID */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            {/* STEPS COLUMN */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
              <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                <BookOpen className="text-indigo-500" size={20} />
                Техника выполнения
              </h3>
              <ul className="space-y-4">
                {activeTest.steps.map((step, index) => (
                  <li key={index} className="flex gap-3 text-slate-700 text-sm leading-relaxed">
                    <span className="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-xs font-bold mt-0.5">
                      {index + 1}
                    </span>
                    <span>{step}</span>
                  </li>
                ))}
              </ul>
            </div>

            {/* NUANCES COLUMN */}
            <div className="space-y-6">
              <div className="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                  <AlertCircle className="text-amber-500" size={20} />
                  Важные нюансы
                </h3>
                <ul className="space-y-3">
                  {activeTest.nuances.map((nuance, index) => (
                    <li key={index} className="flex gap-3 text-slate-600 text-sm bg-amber-50/50 p-3 rounded-lg border border-amber-100/50">
                      <Info className="flex-shrink-0 text-amber-500 mt-0.5" size={16} />
                      <span>{nuance}</span>
                    </li>
                  ))}
                </ul>
              </div>

              {/* TIPS BOX */}
              <div className="bg-teal-50 rounded-xl p-6 border border-teal-100">
                <h4 className="text-sm font-bold text-teal-800 uppercase tracking-wide mb-2">Совет терапевта</h4>
                <p className="text-sm text-teal-700 italic">
                  "Помните: Тест считается положительным только при воспроизведении знакомой боли пациента и наличии асимметрии с здоровой стороной."
                </p>
              </div>
            </div>

          </div>
        </div>
      </main>
    </div>
  );
};

export default App;
